# Agent Skills 规范与示例

本文档描述 Viking Agent 技能注册表的**存储与格式约定**，以及两个示例技能定义。当前仅作设计文档，不做实现。

---

## 1. 概述

- **位置**：Agent 技能存放在 `db/data/openviking/viking/agent/skills`，与 memories、instructions 并列。
- **协议**：采用 **Claude Skills 协议**，**扁平存储**：一个技能一个文件，便于按 tag 检索后选择执行。
- **流程**：根据任务用 `tags` 或 `description` 检索候选技能 → 选出最匹配的一个 → 按该技能的说明执行（或调用对应后端 API）。

---

## 2. 存储与格式约定

### 2.1 文件命名

- 单文件：`{name}.SKILL.md`
- `name` 与 frontmatter 中的 `name` 一致，小写，单词用连字符（如 `summarize-document`）。

### 2.2 Frontmatter（YAML）

| 字段 | 必填 | 说明 |
|------|------|------|
| `name` | 是 | 唯一标识，小写连字符，对应 slash 命令 `/name` |
| `description` | 是 | 技能做什么、何时使用；用于自动匹配与检索 |
| `tags` | 推荐 | 字符串数组，用于按类别检索（如 `["document", "ai"]`） |

### 2.3 正文

- Markdown 正文为「调用说明」：何时使用、步骤、输入/输出、错误处理、示例。
- 检索时先按 `tags`/`description` 筛出候选，再选最合适的一个执行；执行时以正文为指引。

### 2.4 模板结构

```markdown
---
name: my-skill
description: 一句话说明何时用、做什么
tags: [tag1, tag2]
---

# My Skill

## 何时使用
...

## 步骤
1. ...
2. ...

## 输入/输出
...

## 示例
...
```

### 2.5 检索与执行流程

1. 根据当前任务用 `tags` 或语义检索 `description`，得到候选技能列表。
2. 从中选出最匹配的一个技能。
3. 加载该技能的 `SKILL.md`，按正文步骤执行（或调用对应后端 API）。

---

## 3. 示例技能一：文档摘要 (summarize-document)

### Frontmatter

```yaml
---
name: summarize-document
description: 对用户上传的文档生成摘要；当用户请求「总结/概括这份文档」或上传后要求摘要时使用。
tags: [document, ai, summarization, tutor]
---
```

### 何时使用

- 用户上传文档后请求总结、概括或摘要。
- 用户问「这份材料讲了什么」「用几句话概括一下」。
- 与学习/复习场景相关，需要先有文档内容再生成摘要。

### 输入

- **文档**：已上传的文档 ID 或原始文本（PDF/DOCX/TXT/MD 解析后的文本）。
- **可选**：摘要详细程度（brief / normal / detailed）。

### 步骤

1. 确认文档已存在且可读；若为 ID，先拉取文档内容或已缓存的 chunk。
2. 若需 RAG：从向量/关键词检索中取与「整体主题」相关的片段作为上下文。
3. 调用后端摘要接口（如 `POST /api/ai/summarize`），传入文档内容与可选 detail 级别。
4. 将返回的摘要以友好格式呈现给用户；若角色有 TTS，可提供「朗读摘要」选项。

### 输出

- 结构化摘要文本（可带标题、段落、要点列表）。
- 可选：字数、预估阅读时间、与学习目标的关联说明。

### 错误与边界

- 文档为空或未上传：提示用户先上传或选择文档。
- 摘要失败（API 错误）：给出简短说明并建议重试或缩短文档。

### 示例

**用户**：「把刚才上传的 PDF 总结一下。」  
**Agent**：调用 `summarize-document`，取当前会话中的文档 ID → 请求摘要 → 回复摘要内容并问是否要朗读或生成闪卡。

---

## 4. 示例技能二：生成闪卡 (generate-flashcards)

### Frontmatter

```yaml
---
name: generate-flashcards
description: 基于当前文档或指定内容生成学习用闪卡（问答对）；当用户要求「做闪卡/出题/生成卡片」时使用。
tags: [document, ai, flashcards, study, tutor]
---
```

### 何时使用

- 用户请求「根据这份文档做闪卡」「帮我出几道题」「生成记忆卡片」。
- 学习流程中需要从材料自动生成 Q&A 或填空式闪卡。

### 输入

- **文档**：文档 ID 或已解析的文本/片段。
- **可选**：数量（如 5/10/20 张）、难度、是否含解释。

### 步骤

1. 确认文档或内容来源；若为 ID，获取文档或相关 chunk。
2. 可选：用 RAG 检索与「考点/概念」相关的段落，提高题目质量。
3. 调用后端闪卡生成接口（如 `POST /api/ai/generate-flashcards`），传入内容与数量等参数。
4. 将返回的闪卡列表写入存储（若后端未持久化则由调用方写入）。
5. 向用户确认生成结果，并引导进入「复习」或「开始学习」流程。

### 输出

- 闪卡列表：每张含问题、答案、可选解释与元数据（来源、难度）。
- 持久化后的闪卡 ID 或链接，便于后续复习与进度跟踪。

### 错误与边界

- 内容过短无法出题：提示用户补充材料或选择更长文档。
- 生成数量未达请求：说明实际生成数量并建议调整范围或内容。

### 示例

**用户**：「用第三章的内容给我生成 10 张闪卡。」  
**Agent**：调用 `generate-flashcards`，限定内容为第三章 → 请求生成 10 张 → 保存并展示前几张预览，邀请用户开始复习。

---

## 5. 后续扩展

- 新增技能时，在 `db/data/openviking/viking/agent/skills` 下新增 `{name}.SKILL.md`，按本文档 §2 的约定编写。
- 可实现「按 tags 检索 + description 语义检索」的检索层，再按正文执行或映射到后端 API。
